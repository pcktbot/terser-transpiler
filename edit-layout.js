"use strict";function _callSuper(t,e,i){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,i||[],_getPrototypeOf(t).constructor):e.apply(t,i))}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var EditWidgetModal=function(){function t(e,i,n){_classCallCheck(this,t),this.topModal=window.top.$(".modal-content"),this.widgetId=e,this.widgetName=i,this.rowWidgetId=n,this.setModal()}return _createClass(t,[{key:"setModal",value:function(){this.topModal.data("component").set("selectedWidgetName",this.widgetName),this.topModal.find(".heading").text("Edit ".concat(this.widgetName))}}]),t}(),EditLayout=function(t){function e(){var t;return _classCallCheck(this,e),(t=_callSuper(this,e)).ogCms&&(t.initDraggableObjects(),t.setSettingsList(),t.initLayoutWidgetModal()),t}return _inherits(e,EditDraggable),_createClass(e,[{key:"layoutClass",value:function(t){return this.layoutClasses()[t]}},{key:"allLayoutClasses",value:function(){return this.layoutClasses()[0]}},{key:"getLayoutTag",value:function(){return".".concat(this.layoutTag(),"-widgets")}},{key:"initDraggableObjects",value:function(){var t=this;this.draggableObjects().each((function(e,i){var n=$(i);t.makeDraggable(n),t.initSelects(n)}))}},{key:"openLayoutWidgetModal",value:function(t){this.editWidgetModal=new EditWidgetModal(t,null),this.editWidgetModal.getEditForm()}},{key:"initLayoutWidgetModal",value:function(){this.initChangeLayout(),this.updatePositions(!1),this.hideDraggableObjects(),this.hideSaveWarning(),this.showSelectedLayout()}},{key:"initChangeLayout",value:function(){var t=this;this.getSelectedLayout().on("change",(function(e){t.showSaveWarning(),t.hideDraggableObjects(),t.hideEditLinks(),t.showSelectedLayout()}))}},{key:"initSelects",value:function(t){var e=this;t.find("select").on("change",(function(t){e.selectChanged($(t.currentTarget))}))}},{key:"selectChanged",value:function(t){var e=t.val();t.find("option[selected]").removeAttr("selected"),t.find('option[value="'+e+'"]').attr("selected",!0),this.showSaveWarning(),this.hideEditLinks()}},{key:"initEditLinks",value:function(t){var e=this,i=this.topModal.find(".".concat(this.layoutTag(),"-edit")).data("".concat(this.layoutTag(),"-id"));t.find(".edit-widget").on("click",(function(t){var n=$(t.currentTarget);return e.editWidgetModal=new EditWidgetModal(n.data("widget-id"),n.data("widget-name"),i),e.editWidgetModal.getEditForm(),!1}))}},{key:"afterDragDrop",value:function(){this.updatePositions(!0),this.showSaveWarning()}},{key:"draggableContainer",value:function(){return this.topModal.find(".layout-fields")}},{key:"draggableClass",value:function(){return this.getLayoutTag()}},{key:"draggableData",value:function(){return{index:this.dragElem.data("index")}}},{key:"draggableObjects",value:function(){return this.topModal.find(this.getLayoutTag())}},{key:"updatePositions",value:function(t){var e=this;this.draggableObjects().each((function(i,n){e.updatePosition(i,n,t)})),t&&this.transferSettings()}},{key:"updatePosition",value:function(t,e,i){var n=$(e),o=t+1,a=this.layoutTitle().toLowerCase()+"_"+o;n.removeClass(this.allLayoutClasses()).addClass(this.layoutClass(t)),n.attr("data-index",a).data("index",a),n.find("label").text("".concat(this.layoutTitle()," ").concat(o," Widget")),i&&(n.hasClass("dropped")||(n.find(".edit-widget").hide(),n.find("select").material_select(),n.addClass("dropped")))}},{key:"setSettingsList",value:function(){var t=this;this.settingsList=[],this.draggableObjects().each((function(e,i){var n=$(i);t.settingsList.push({name:n.data("name"),id:n.data("id")})}))}},{key:"transferSettings",value:function(){var t=this;this.draggableObjects().each((function(e,i){var n=$(i);n=t.transferSetting(n,"name",t.settingsList[e].name),n=t.transferSetting(n,"id",t.settingsList[e].id)})),this.setSettingsList()}},{key:"transferSetting",value:function(t,e,i){var n=t.data(e);t.attr("data-"+e,i).data(e,i);var o=t.html(),a=new RegExp(n,"g");return t.html(o.replace(a,i)),t}},{key:"getSelectedLayout",value:function(){return this.topModal.find(".".concat(this.selectLayoutTag()," select"))}},{key:"showSelectedLayout",value:function(){var t=this.getSelectedLayout().val();$(".".concat(t)).show()}},{key:"hideDraggableObjects",value:function(){this.draggableObjects().hide()}},{key:"hideEditLinks",value:function(){this.topModal.find(".edit-widget").hide()}},{key:"hideSaveWarning",value:function(){this.topModal.find(".save-warning").removeClass("show")}},{key:"showSaveWarning",value:function(){this.topModal.find(".save-warning").addClass("show")}},{key:"selectLayoutTag",value:function(){throw new Error("selectLayoutTag not defined")}},{key:"layoutTag",value:function(){throw new Error("layoutTag not defined")}},{key:"layoutTitle",value:function(){throw new Error("layoutTitle not defined")}},{key:"layoutClasses",value:function(){throw new Error("layoutClasses not defined")}}]),e}();